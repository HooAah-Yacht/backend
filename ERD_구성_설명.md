# ERD 구성 요약 및 결정 이유

작성일: 2025-11-10
대상: 개발팀
목적: ERD(스키마) 변경사항을 팀원이 빠르게 이해하도록 "한 장 요약" 형태로 정리합니다.

---

## 한줄 요약

테이블은 가독성을 위해 한글로 명명했으며(예: `사용자`, `요트`, `부품` 등), 각 테이블에 PK/인덱스/FK와 적절한 ON DELETE 정책을 추가해 데이터 무결성과 조회 성능을 확보했습니다. `예약` 엔티티를 새로 추가해 핵심 기능(예약 흐름)을 지원합니다.

---

## 왜 이렇게 구성했는가 (핵심 결정과 이유)

- 테이블명(한글)

  - 팀이 ERD를 빠르게 읽고 이해하도록 한글명으로 통일했습니다. 코드에서는 `@Table(name = "한글명")`으로 매핑합니다.

- 기본 키(PK)와 AUTO_INCREMENT

  - 모든 주요 엔티티에 `id` PK + AUTO_INCREMENT를 둬 안정적 식별과 ORM 매핑을 보장합니다.

- 외래키(FK)와 ON DELETE 정책

  - 부모-자식 무결성을 위해 FK를 설정했습니다.
  - `CASCADE`를 사용한 경우: 부모 삭제 시 종속 데이터도 함께 제거(예: `요트` 삭제 → `부품`, `예약`, `켈린더` 등 정리).
  - `SET NULL`을 사용한 경우: 기록 보존이 필요할 때(예: 작성자 삭제 시 정비기록은 보존, 작성자 정보만 해제).

- 인덱스

  - FK 칼럼과 자주 조회되는 칼럼에 인덱스를 추가해 조인/조회 성능을 보강했습니다.

- 예약(`예약`) 엔티티 추가 이유

  - 기능명세와 피그마에서 요구하는 예약 흐름(요트 예약, 충돌검증, 예약 상태 관리)을 지원하기 위해 신설했습니다.

- 부품(재고·단가)·정비(비용·요트 연계) 확장

  - 실제 서비스에서 재고관리·비용 집계가 필요하므로 `부품`에 `quantity`, `unit_price`를 추가하고 `정비_내역`에 `cost`·`yacht_id`를 추가했습니다.

- 알림·캘린더 통합
  - `켈린더`와 `알림`을 통해 예약·정비 일정과 연동해 사용자에게 알림을 보낼 수 있도록 설계했습니다.

---

## 테이블별 간단 설명 (한 줄씩)

- `사용자`: 이메일(유일)로 인증, 역할(role), 연락처 저장.
- `요트`: 요트 기본 정보(이름, 위치, 가격, 소유자) 및 가용성 표시.
- `부품`: 요트에 속한 부품, 재고·단가·교체일 관리.
- `정비사`: 정비 담당자 정보(선택적).
- `요트_사용자`: 유저와 요트의 M:N 관계 매핑(중복 방지 위해 복합 PK 유지).
- `정비_내역`: 정비 기록(누가, 언제, 어느 부품, 어떤 요트, 비용, 정비사).
- `켈린더`: 부품/요트 단위의 일정(정비/예약 표시), 예약과 연동 예정.
- `알림`: 부품 교체·정비 완료·예약 리마인더 등 알림 저장.
- `예약`: 유저가 생성한 요트 예약(시간 범위, 상태, 요금).

---

## 코드와의 매핑 주의사항

- 테이블명이 한글이므로 Java 엔티티에 반드시 `@Table(name = "한글명")`을 추가하세요.
- 컬럼 네이밍은 snake_case로 유지했으므로 필요하면 `@Column(name = "...")`로 매핑합니다.
- 예: `@Entity @Table(name = "정비\_내역") public class Repair { @Column(name="repair_date") private LocalDate repairDate; }

---

## 마이그레이션·배포 권장 순서

1. 스테이징 DB 백업(스냅샷)
2. Flyway 마이그레이션 파일 적용(스테이징)
3. 스테이징에서 핵심 시나리오(예약 생성/정비 등록/캘린더 조회) 테스트
4. 운영 DB 배포 전 전체 백업
5. 운영 반영

---

## 향후 결정해야 할 것들 (팀 합의 필요)

- FK의 ON DELETE 정책(기록 보존 vs 부모 삭제시 정리) 최종 확정
- `사용자` 테이블명 `user` vs `사용자` 사용 정책(영문/한글 통일)
- `정비_내역` 등 공백·특수문자 포함 테이블명을 코드에서 어떻게 처리할지 표준화

---

필요하면 이 문서를 기반으로 ERDCloud 엔티티 노트(각 테이블에 붙일 짧은 메모)도 생성해 드리겠습니다.

작성자: 팀 협업 도우미
